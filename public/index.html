<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv='X-UA-Compatible' content='ie=edge'>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Source+Code+Pro&display=swap" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
    <title>GitHub Workshop</title>
</head>
<body>
    <script>
        var level;
        //nextlevel stores the next level to be loaded. This defines the default value:
        var nextlevel = "template";
        //Here we load the default level currently defined as nextlevel:
        loadlevel(nextlevel);

        function loadlevel(llevel){
            //Make an HTTP request to the /json/ route of our express server:
            fetch("/json", {
                method: "post",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    level: llevel
                })
            })
            //Get the request body and convert to JSON:
            .then((res)=> res.json())
            //Here we have the request body as a JSON object ready to be used:
            .then((data)=>{
                level = data;
                document.getElementById("levelname").innerHTML = data.title;
                document.getElementById("levelauthor").innerHTML = data.author;
                document.getElementById("gamearea").innerHTML = data.onenter + " " + data.prompt;
                nextlevel = data.next;
                console.log(data);
                document.addEventListener('keyup', function(e){
                    var text = document.getElementById("input").value;
                    if (e.keyCode == 13 && text.toString().indexOf("hello") != -1){
                        next(nextlevel);
                        document.getElementById("gamearea").innerHTML += "<br/>" + text;
                        //This does not yet work, still not sure why:
                        document.getElementById("input").value = "";
                    } else if (e.keyCode == 13){
                        console.log(text);
                        document.getElementById("gamearea").innerHTML += "<br/>" + text;
                        //This does not yet work, still not sure why:
                        document.getElementById("input").value = "";
                    }
                })
                
            })
            .catch(console.error);
        }

        function next(nextlevel){
            loadlevel(nextlevel)
        }

    </script>

    <div id="container">
        <div id="navbar">
            <img src="images/githubworkshoplogo.png" id="logo">
        </div>
        <div id="terminal">
            <div id="leveldetails">
                <h1 id="levelname"></h1><h2 id="levelauthor"></h2>
            </div>
            <div id="gamearea">
                
            </div>
            <input id='input' autofocus>
        </div>
    </div>
</body>
</html>